<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<title>Pesquisa Cultural – Instituto Sumaúma</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>
html,body{
  margin:0;
  height:100%;
  font-family:Arial, sans-serif;
}

/* ===== HEADER ===== */
header{
  height:70px;
  background:#0f3d2e;
  color:#fff;
  display:flex;
  align-items:center;
  padding:0 20px;
}
header img{
  height:40px;
  margin-right:15px;
}
header h1{
  font-size:20px;
  margin:0;
}

/* ===== LAYOUT ===== */
#container{
  display:flex;
  height:calc(100% - 70px);
}

/* ===== SIDEBAR ===== */
#sidebar{
  width:50%;
  max-width:480px;
  background:#fff;
  border-right:1px solid #ddd;
  overflow:auto;
  transition:.3s;
}

.sidebar-inner{
  padding:20px;
}

input[type="text"]{
  width:100%;
  padding:10px;
  margin-bottom:15px;
  font-size:14px;
}

.result{
  padding:12px;
  border:1px solid #ddd;
  margin-bottom:10px;
  cursor:pointer;
}
.result:hover{
  background:#f2f2f2;
}
.result strong{
  display:block;
}

/* ===== MAP ===== */
#map{
  width:50%;
  transition:.3s;
}

/* ===== DETAILS PANEL ===== */
#details{
  display:none;
  width:50%;
  padding:20px;
  overflow:auto;
}

#details h2{
  margin-top:0;
}

.info-item{
  margin-bottom:8px;
}

/* ===== BUTTONS ===== */
.buttons{
  margin-top:20px;
}
.buttons a{
  display:inline-block;
  padding:10px 15px;
  margin-right:10px;
  text-decoration:none;
  color:#fff;
  border-radius:4px;
}
.btn-contact{
  background:#25D366;
}
.btn-map{
  background:#0f3d2e;
}

/* ===== STATES ===== */
.full-map #sidebar,
.full-map #details{
  display:none;
}
.full-map #map{
  width:100%;
}

.show-details #map{
  display:none;
}
.show-details #details{
  display:block;
}

/* RESPONSIVE */
@media(max-width:900px){
  #sidebar,#map,#details{
    width:100%;
  }
}
</style>
</head>

<body>

<header>
  <img src="logo-sumauma.png" alt="Instituto Sumaúma">
  <h1>Mapeamento Cultural</h1>
</header>

<div id="container">

  <!-- SIDEBAR -->
  <div id="sidebar">
    <div class="sidebar-inner">
      <input type="text" id="search" placeholder="Pesquisar iniciativas culturais...">
      <div id="results"></div>
    </div>
  </div>

  <!-- DETAILS -->
  <div id="details"></div>

  <!-- MAP -->
  <div id="map"></div>

</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
/* ===== DATA (simula planilha/JSON) ===== */
const data = [
  {
    nome: "Rede Kalunga Comunicações",
    cidade: "Cavalcante",
    estado: "GO",
    categoria: "Comunicação Comunitária",
    descricao: "Projeto de comunicação popular voltado à valorização cultural Kalunga.",
    contato: "https://www.instagram.com/redekalunga",
    lat: -13.7975,
    lng: -47.4581
  }
];

/* ===== MAP INIT ===== */
const map = L.map('map').setView([-14.235, -51.9253], 4);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  attribution:'© OpenStreetMap'
}).addTo(map);

const markers = [];

/* ===== CREATE MARKERS ===== */
data.forEach(item=>{
  const marker = L.marker([item.lat,item.lng]).addTo(map);
  marker.bindPopup(`
    <strong>${item.nome}</strong><br>
    ${item.cidade} - ${item.estado}<br>
    ${item.categoria}<br><br>
    ${item.descricao}<br><br>
    <a href="${item.contato}" target="_blank">Entrar em contato</a>
  `);
  markers.push({marker,item});
});

/* ===== SEARCH ===== */
const resultsEl = document.getElementById('results');
document.getElementById('search').addEventListener('input',e=>{
  const val = e.target.value.toLowerCase();
  resultsEl.innerHTML = '';

  data.filter(d=>d.nome.toLowerCase().includes(val))
      .forEach(d=>{
        const div = document.createElement('div');
        div.className = 'result';
        div.innerHTML = `
          <strong>${d.nome}</strong>
          ${d.cidade} - ${d.estado}<br>
          ${d.categoria}
        `;
        div.onclick = ()=>showDetails(d);
        resultsEl.appendChild(div);
      });
});

/* ===== SHOW DETAILS ===== */
function showDetails(item){
  document.body.classList.add('show-details');
  document.getElementById('details').innerHTML = `
    <h2>${item.nome}</h2>
    <div class="info-item"><strong>Cidade:</strong> ${item.cidade} - ${item.estado}</div>
    <div class="info-item"><strong>Categoria:</strong> ${item.categoria}</div>
    <div class="info-item"><strong>Descrição:</strong><br>${item.descricao}</div>

    <div class="buttons">
      <a class="btn-contact" href="${item.contato}" target="_blank">Entrar em contato</a>
      <a class="btn-map" href="#" onclick="viewOnMap(${item.lat},${item.lng});return false;">Ver no mapa</a>
    </div>
  `;
}

/* ===== VIEW ON MAP ===== */
function viewOnMap(lat,lng){
  document.body.classList.remove('show-details');
  document.body.classList.add('full-map');

  map.invalidateSize();
  map.setView([lat,lng],15);

  markers.forEach(m=>{
    if(m.item.lat === lat){
      m.marker.openPopup();
    }
  });
}
</script>

</body>
</html>

<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<title>Mapeamento Cultural – Instituto Sumaúma</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>
/* ================= RESET ================= */
html, body {
  margin: 0;
  height: 100%;
  font-family: Arial, sans-serif;
}

/* ================= HEADER ================= */
header {
  background: #0f3d2e;
  color: #fff;
}

.header-top {
  height: 80px;
  display: flex;
  align-items: center;
  padding: 0 20px;
}

.header-top img {
  height: 45px;
  margin-right: 15px;
}

.header-banner {
  height: 220px;
  background: url('banner-capa.png') center/cover no-repeat;
}

/* ================= LAYOUT ================= */
#layout {
  display: flex;
  height: calc(100% - 300px);
}

/* ================= SIDEBAR ================= */
#sidebar {
  width: 420px;
  min-width: 420px;
  background: #fff;
  border-right: 1px solid #ddd;
  overflow-y: auto;
}

.sidebar-inner {
  padding: 20px;
}

/* Busca */
#search {
  width: 100%;
  padding: 10px;
  margin-bottom: 15px;
}

/* Resultados */
#results .item {
  border: 1px solid #ddd;
  padding: 10px;
  margin-bottom: 10px;
  cursor: pointer;
}

#results .item:hover {
  background: #f2f2f2;
}

/* ================= MAPA ================= */
#content {
  flex: 1;
  position: relative;
}

#map {
  width: 100%;
  height: 100%;
}

/* ================= DETALHES ================= */
#details-panel {
  display: none;
  position: absolute;
  top: 0;
  right: 0;
  width: 420px;
  height: 100%;
  background: #fff;
  border-left: 1px solid #ddd;
  padding: 20px;
  overflow-y: auto;
  z-index: 1000;
}

#details-panel h2 {
  margin-top: 0;
}

/* ================= BOTÕES ================= */
.btn {
  display: inline-block;
  padding: 10px 14px;
  margin-top: 10px;
  margin-right: 10px;
  border-radius: 4px;
  text-decoration: none;
  cursor: pointer;
  color: #fff;
}

.btn-contact {
  background: #25D366;
}

.btn-map {
  background: #0f3d2e;
}

/* ================= ESTADOS ================= */
.show-details #details-panel {
  display: block;
}

.full-map #sidebar,
.full-map #details-panel {
  display: none;
}

/* ================= RESPONSIVO ================= */
@media (max-width: 900px) {
  #layout {
    flex-direction: column;
  }
  #sidebar {
    width: 100%;
    min-width: 100%;
  }
}
</style>
</head>

<body>

<!-- ================= HEADER ================= -->
<header>
  <div class="header-top">
    <img src="instituto_sumauma.png" alt="Instituto Sumaúma">
    <h1>Mapeamento Cultural</h1>
  </div>
  <div class="header-banner"></div>
</header>

<!-- ================= MAIN ================= -->
<div id="layout">

  <!-- ===== SIDEBAR (MENU FINAL) ===== -->
  <aside id="sidebar">
    <div class="sidebar-inner">

      <!-- Aqui entram filtros, abas e selects do CSV -->
      <input type="text" id="search" placeholder="Pesquisar iniciativas culturais...">

      <!-- Resultados do CSV -->
      <div id="results"></div>

    </div>
  </aside>

  <!-- ===== CONTEÚDO ===== -->
  <section id="content">

    <!-- MAPA -->
    <div id="map"></div>

    <!-- PAINEL DE DETALHES -->
    <div id="details-panel"></div>

  </section>

</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
/* ================= MAPA ================= */
const map = L.map('map').setView([-14.235, -51.9253], 4);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  attribution: '© OpenStreetMap'
}).addTo(map);

/* ================= DADOS (EXEMPLO) =================
   ⚠️ ESTE BLOCO SERÁ SUBSTITUÍDO PELO CSV REAL
*/
const dados = [
  {
    nome: "Rede Kalunga Comunicações",
    cidade: "Cavalcante",
    estado: "GO",
    categoria: "Comunicação Comunitária",
    descricao: "Projeto de comunicação cultural e comunitária.",
    contato: "https://www.instagram.com/",
    lat: -13.7975,
    lng: -47.4581
  }
];

const markers = [];
const resultsEl = document.getElementById("results");

/* ================= RENDER MENU ================= */
dados.forEach(item => {

  const marker = L.marker([item.lat, item.lng]).addTo(map);
  marker.bindPopup(`
    <strong>${item.nome}</strong><br>
    ${item.cidade} - ${item.estado}<br>
    ${item.categoria}<br><br>
    ${item.descricao}<br><br>
    <a href="${item.contato}" target="_blank">Entrar em contato</a>
  `);

  markers.push({ marker, item });

  const div = document.createElement("div");
  div.className = "item";
  div.innerHTML = `
    <strong>${item.nome}</strong><br>
    ${item.cidade} - ${item.estado}<br>
    ${item.categoria}
  `;

  div.onclick = () => abrirDetalhes(item);
  resultsEl.appendChild(div);
});

/* ================= DETALHES ================= */
function abrirDetalhes(item){
  document.body.classList.add("show-details");
  document.body.classList.remove("full-map");

  document.getElementById("details-panel").innerHTML = `
    <h2>${item.nome}</h2>
    <p><strong>Cidade:</strong> ${item.cidade} - ${item.estado}</p>
    <p><strong>Categoria:</strong> ${item.categoria}</p>
    <p>${item.descricao}</p>

    <a class="btn btn-contact" href="${item.contato}" target="_blank">
      Entrar em contato
    </a>

    <button class="btn btn-map" onclick="verNoMapa(${item.lat}, ${item.lng})">
      Ver no mapa
    </button>
  `;
}

/* ================= VER NO MAPA ================= */
function verNoMapa(lat, lng){
  document.body.classList.remove("show-details");
  document.body.classList.add("full-map");

  map.invalidateSize();
  map.setView([lat, lng], 15);

  markers.forEach(m => {
    if (m.item.lat === lat) {
      m.marker.openPopup();
    }
  });
}
</script>

</body>
</html>

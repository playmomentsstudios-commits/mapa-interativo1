<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<title>Painel Admin â€“ Mapeamento</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:Arial,sans-serif;
  background:#eef1f4;
  margin:0;
  padding:20px
}
.hidden{display:none}
.login{
  max-width:360px;
  margin:120px auto;
  background:#fff;
  padding:30px;
  border-radius:10px;
  box-shadow:0 4px 12px rgba(0,0,0,.15)
}
.login h2{text-align:center}
.login input{
  width:100%;
  padding:12px;
  margin-top:10px
}
.login button{
  width:100%;
  padding:12px;
  margin-top:20px;
  background:#111;
  color:#fff;
  border:none;
  border-radius:6px;
  cursor:pointer
}
.container{max-width:1200px;margin:auto}
.toolbar{margin-bottom:15px}
.toolbar button{
  margin-right:10px;
  padding:8px 14px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  background:#111;
  color:#fff
}
fieldset{
  background:#fff;
  padding:15px;
  margin-bottom:20px;
  border-radius:8px;
  border:1px solid #ddd
}
legend{font-weight:bold}
label{display:block;margin-top:10px}
input[type="text"]{
  width:100%;
  padding:8px;
  margin-top:4px
}
table{
  width:100%;
  border-collapse:collapse;
  background:#fff
}
th,td{
  border:1px solid #ddd;
  padding:8px;
  font-size:13px
}
th{
  background:#111;
  color:#fff
}
.actions button{
  padding:4px 8px;
  background:#c0392b;
  color:#fff;
  border:none;
  border-radius:4px;
  cursor:pointer
}
.error{color:red;margin-top:10px}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox" class="login">
  <h2>ğŸ” Acesso Restrito</h2>
  <input id="loginUser" placeholder="UsuÃ¡rio">
  <input id="loginPass" type="password" placeholder="Senha">
  <button id="loginBtn">Entrar</button>
  <div id="loginError" class="error"></div>
</div>

<!-- PAINEL -->
<div id="panelBox" class="container hidden">

  <h1>ğŸ“Š Painel â€“ Mapeamento Mestre</h1>

  <!-- CONFIGURAÃ‡Ã•ES VISUAIS -->
  <fieldset>
    <legend>ğŸ¨ ConfiguraÃ§Ãµes do Banner</legend>

    <label>TÃ­tulo da Pesquisa</label>
    <input id="cfgTitle" type="text" placeholder="TÃ­tulo principal">

    <label>SubtÃ­tulo</label>
    <input id="cfgSubtitle" type="text" placeholder="SubtÃ­tulo">

    <label>Imagem Banner Topo (1920x300)</label>
    <input id="cfgBannerTop" type="text" placeholder="banner-capa.png">

    <label>Imagem Banner RodapÃ© (1920x220)</label>
    <input id="cfgBannerFooter" type="text" placeholder="banner-rodape.png">

    <label>Logo RealizaÃ§Ã£o</label>
    <input id="cfgLogoRealizacao" type="text" placeholder="instituto_sumauma.png">

    <label>Logo Financiamento</label>
    <input id="cfgLogoFinanciamento" type="text" placeholder="climate_land_use_alliance.png">

    <button id="downloadConfig">ğŸ’¾ Baixar config.json</button>
  </fieldset>

  <!-- DADOS -->
  <div class="toolbar">
    <button id="addBtn">â• Adicionar registro</button>
    <button id="downloadBtn">ğŸ’¾ Baixar CSV atualizado</button>
    <button id="logoutBtn">Sair</button>
  </div>

  <table id="dataTable"></table>
</div>

<script>
const ADMIN_USER="adm";
const ADMIN_PASS="6202";

const loginBox=document.getElementById("loginBox");
const panelBox=document.getElementById("panelBox");

loginBtn.onclick=()=>{
  if(loginUser.value===ADMIN_USER && loginPass.value===ADMIN_PASS){
    localStorage.setItem("adminAuth","true");
    showPanel();
  }else loginError.innerText="UsuÃ¡rio ou senha invÃ¡lidos";
};

logoutBtn.onclick=()=>{
  localStorage.removeItem("adminAuth");
  location.reload();
};

function showPanel(){
  loginBox.classList.add("hidden");
  panelBox.classList.remove("hidden");
  loadCSV();
}

if(localStorage.getItem("adminAuth")==="true") showPanel();

/* ===== CONFIG JSON ===== */
downloadConfig.onclick=()=>{
  const cfg={
    title:cfgTitle.value,
    subtitle:cfgSubtitle.value,
    bannerTop:cfgBannerTop.value,
    bannerFooter:cfgBannerFooter.value,
    logoRealizacao:cfgLogoRealizacao.value,
    logoFinanciamento:cfgLogoFinanciamento.value
  };
  const blob=new Blob([JSON.stringify(cfg,null,2)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="config.json";
  a.click();
};

/* ===== CSV ===== */
const headers=[
  "id","nome","categoria","cidade","estado",
  "latitude","longitude","territorio",
  "contato","descricao","observacao"
];
let data=[];
const table=document.getElementById("dataTable");

function loadCSV(){
  fetch("Mapeamento_mestre.csv")
  .then(r=>r.text())
  .then(t=>{
    const lines=t.trim().split("\n");
    data=lines.slice(1).map(l=>{
      const c=l.split(",");
      let o={};
      headers.forEach((h,i)=>o[h]=c[i]||"");
      return o;
    });
    renderTable();
  });
}

function renderTable(){
  let html="<tr>"+headers.map(h=>`<th>${h}</th>`).join("")+"<th>AÃ§Ãµes</th></tr>";
  data.forEach((r,i)=>{
    html+="<tr>";
    headers.forEach(h=>{
      html+=`<td contenteditable data-i="${i}" data-h="${h}">${r[h]}</td>`;
    });
    html+=`<td class="actions"><button onclick="removeRow(${i})">ğŸ—‘ï¸</button></td></tr>`;
  });
  table.innerHTML=html;

  table.querySelectorAll("td[contenteditable]").forEach(td=>{
    td.oninput=()=>data[td.dataset.i][td.dataset.h]=td.innerText;
  });
}

function removeRow(i){
  if(confirm("Excluir registro?")){
    data.splice(i,1);
    renderTable();
  }
}

addBtn.onclick=()=>{
  let o={};
  headers.forEach(h=>o[h]="");
  data.push(o);
  renderTable();
};

downloadBtn.onclick=()=>{
  let csv=headers.join(",")+"\n";
  data.forEach(r=>{
    csv+=headers.map(h=>`"${(r[h]||"").replace(/"/g,'""')}"`).join(",")+"\n";
  });
  const blob=new Blob([csv],{type:"text/csv"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="Mapeamento_mestre.csv";
  a.click();
};
</script>

</body>
</html>

<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<title>Painel Admin â€“ Mapeamento</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:Arial,sans-serif;background:#eef1f4;margin:0;padding:20px}
.hidden{display:none}
.login{
  max-width:360px;margin:120px auto;background:#fff;padding:30px;
  border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,.15)
}
.login input,button{width:100%;padding:12px;margin-top:10px}
button{background:#111;color:#fff;border:none;border-radius:6px;cursor:pointer}
.container{max-width:1200px;margin:auto}
table{width:100%;border-collapse:collapse;background:#fff}
th,td{border:1px solid #ddd;padding:8px;font-size:13px}
th{background:#111;color:#fff}
.actions button{margin-right:5px;padding:6px 10px;font-size:12px}
.toolbar{margin-bottom:15px}
.toolbar button{margin-right:10px}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login" class="login">
  <h2>ğŸ” Acesso Restrito</h2>
  <input id="user" placeholder="UsuÃ¡rio">
  <input id="pass" type="password" placeholder="Senha">
  <button onclick="login()">Entrar</button>
  <div id="error" style="color:red;margin-top:10px"></div>
</div>

<!-- PAINEL -->
<div id="panel" class="container hidden">
  <h1>ğŸ“Š Painel â€“ Mapeamento Mestre</h1>

  <div class="toolbar">
    <button onclick="addRow()">â• Adicionar registro</button>
    <button onclick="downloadCSV()">ğŸ’¾ Baixar CSV atualizado</button>
    <button onclick="logout()">Sair</button>
  </div>

  <table id="table"></table>
</div>

<script>
/* ===== LOGIN ===== */
const ADMIN_USER = "adm";
const ADMIN_PASS = "6202";

function login(){
  if(user.value === ADMIN_USER && pass.value === ADMIN_PASS){
    localStorage.setItem("adminAuth","true");
    init();
  }else{
    error.innerText="Credenciais invÃ¡lidas";
  }
}
function logout(){
  localStorage.removeItem("adminAuth");
  location.reload();
}

/* ===== CSV ===== */
let data = [];
const headers = [
  "id","nome","categoria","cidade","estado",
  "latitude","longitude","territorio",
  "contato","descricao","observacao"
];

function init(){
  login.classList.add("hidden");
  panel.classList.remove("hidden");
  fetch("Mapeamento_mestre.csv")
    .then(r=>r.text())
    .then(parseCSV)
    .then(renderTable);
}

function parseCSV(text){
  const lines = text.trim().split("\n");
  data = lines.slice(1).map(l=>{
    const cols = l.split(",");
    let obj={};
    headers.forEach((h,i)=>obj[h]=cols[i]||"");
    return obj;
  });
}

function renderTable(){
  let html="<tr>"+headers.map(h=>`<th>${h}</th>`).join("")+"<th>AÃ§Ãµes</th></tr>";
  data.forEach((row,i)=>{
    html+="<tr>";
    headers.forEach(h=>{
      html+=`<td contenteditable oninput="edit(${i},'${h}',this.innerText)">${row[h]}</td>`;
    });
    html+=`<td class="actions">
      <button onclick="removeRow(${i})">ğŸ—‘ï¸</button>
    </td></tr>`;
  });
  table.innerHTML=html;
}

function edit(i,field,val){ data[i][field]=val; }

function addRow(){
  let obj={}; headers.forEach(h=>obj[h]="");
  data.push(obj);
  renderTable();
}

function removeRow(i){
  if(confirm("Excluir este registro?")){
    data.splice(i,1);
    renderTable();
  }
}

function downloadCSV(){
  let csv=headers.join(",")+"\n";
  data.forEach(r=>{
    csv+=headers.map(h=>`"${(r[h]||"").replace(/"/g,'""')}"`).join(",")+"\n";
  });
  const blob=new Blob([csv],{type:"text/csv"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="Mapeamento_mestre.csv";
  a.click();
}

/* ===== INIT ===== */
if(localStorage.getItem("adminAuth")==="true"){
  init();
}
</script>

</body>
</html>
